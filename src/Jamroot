#
# Jamroot
#
# Created by Darren Kessner with John Novembre
#
# Copyright (c) 2013 Regents of the University of California
# All rights reserved.
# 
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
# 
#     * Redistributions of source code must retain the above copyright notice,
#       this list of conditions and the following disclaimer.  
# 
#     * Redistributions in binary form must reproduce the above copyright notice,
#       this list of conditions and the following disclaimer in the documentation
#       and/or other materials provided with the distribution.  
# 
#     * Neither UCLA nor the names of its contributors may be used to endorse or
#       promote products derived from this software without specific prior
#       written permission.  
# 
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#


import testing ; # for unit-test rule
import notfile ;


project forqs
    : default-build
        <warnings-as-errors>on
        <warnings>all
        <runtime-link>static
        <link>static
        <variant>release
        <inlining>off
        #<variant>debug
        #<variant>profile
        #<threading>multi
    : requirements
        <toolset>gcc:<cxxflags>-Wno-parentheses
	<toolset>gcc:<cxxflags>-I.
        <toolset>gcc:<cxxflags>-DUSE_BOOST_SHARED_PTR
        <toolset>clang:<cxxflags>-Wno-logical-op-parentheses
        <toolset>darwin:<cxxflags>-Wno-logical-op-parentheses
        <toolset>clang:<cxxflags>-Wno-nested-anon-types
        <toolset>darwin:<cxxflags>-Wno-nested-anon-types
        <toolset>darwin:<runtime-link>shared
    : build-dir ../build
    ;



lib boost_system ;
lib boost_filesystem ;


lib libforqs :
    Chromosome.cpp 
    ChromosomePairRange.cpp 
    Configurable.cpp
    DataVector.cpp
    Genotype.cpp
    Locus.cpp
    MSFormat.cpp
    MutationGenerator.cpp
    Organism.cpp 
    Parameters.cpp
    Population.cpp
    PopulationData.cpp
    Population_Organisms.cpp
    Population_ChromosomePairs.cpp
    PopulationConfigGenerator.cpp
    QuantitativeTrait.cpp
    RecombinationMap.cpp 
    RecombinationPositionGenerator.cpp
    Random.cpp 
    Reporter.cpp
    Simulator.cpp
    Trajectory.cpp
    VariantIndicator.cpp
    boost_filesystem
    boost_system
    ;


lib libforqs_implementations :
    FitnessFunctionImplementation.cpp
    MutationGeneratorImplementation.cpp
    PopulationConfigGeneratorImplementation.cpp
    PopulationConfigGeneratorExperimental.cpp
    QuantitativeTraitImplementation.cpp
    RecombinationPositionGeneratorImplementation.cpp
    ReporterImplementation.cpp
    SimulationBuilder_Generic.cpp
    VariantIndicatorImplementation.cpp
    muparser//libmuparser    
    ;



#unit-test Testing/ChromosomeTest : Testing/ChromosomeTest.cpp libforqs ;
#unit-test Testing/ChromosomePairRangeTest : Testing/ChromosomePairRangeTest.cpp libforqs ;
#unit-test Testing/ConfigurableTest : Testing/ConfigurableTest.cpp Configurable.cpp Parameters.cpp libforqs ;
#unit-test Testing/FitnessFunctionImplementationTest : Testing/FitnessFunctionImplementationTest.cpp FitnessFunctionImplementation.cpp libforqs ;
#unit-test Testing/GenotypeTest : Testing/GenotypeTest.cpp libforqs ;
#unit-test Testing/LocusTest : Testing/LocusTest.cpp libforqs ;
#unit-test Testing/DataVectorTest : Testing/DataVectorTest.cpp libforqs ;
#unit-test Testing/MSFormatTest : Testing/MSFormatTest.cpp libforqs ;
#unit-test Testing/MutationGeneratorImplementationTest : Testing/MutationGeneratorImplementationTest.cpp MutationGeneratorImplementation.cpp RecombinationPositionGeneratorImplementation.cpp libforqs ;
#unit-test Testing/OrganismTest : Testing/OrganismTest.cpp RecombinationPositionGeneratorImplementation.cpp libforqs ;
#unit-test Testing/ParametersTest : Testing/ParametersTest.cpp Parameters.cpp ;
#unit-test Testing/PopulationTest : Testing/PopulationTest.cpp RecombinationPositionGeneratorImplementation.cpp libforqs ;
#unit-test Testing/PopulationDataTest : Testing/PopulationDataTest.cpp libforqs ;
#unit-test Testing/PopulationConfigGeneratorImplementationTest : Testing/PopulationConfigGeneratorImplementationTest.cpp PopulationConfigGeneratorImplementation.cpp libforqs ;
#unit-test Testing/PopulationConfigGeneratorExperimentalTest : Testing/PopulationConfigGeneratorExperimentalTest.cpp PopulationConfigGeneratorExperimental.cpp libforqs libforqs_implementations ;
#unit-test Testing/Population_Organisms_Test : Testing/Population_Organisms_Test.cpp RecombinationPositionGeneratorImplementation.cpp libforqs ;
#unit-test Testing/Population_ChromosomePairs_Test : Testing/Population_ChromosomePairs_Test.cpp RecombinationPositionGeneratorImplementation.cpp libforqs ;
#unit-test Testing/QuantitativeTraitTest : Testing/QuantitativeTraitTest.cpp ;
#unit-test Testing/QuantitativeTraitImplementationTest : Testing/QuantitativeTraitImplementationTest.cpp QuantitativeTraitImplementation.cpp libforqs muparser//libmuparser ;
#unit-test Testing/RandomTest : Testing/RandomTest.cpp Random.cpp Parameters.cpp ;
#unit-test Testing/RecombinationMapTest : Testing/RecombinationMapTest.cpp libforqs ;
#unit-test Testing/RecombinationPositionGeneratorImplementationTest : Testing/RecombinationPositionGeneratorImplementationTest.cpp RecombinationPositionGeneratorImplementation.cpp libforqs ;
#unit-test Testing/ReporterImplementationTest : Testing/ReporterImplementationTest.cpp ReporterImplementation.cpp libforqs ;
#unit-test Testing/SimulatorTest : Testing/SimulatorTest.cpp libforqs libforqs_implementations ;
#unit-test Testing/SimulationBuilder_Generic_Test : Testing/SimulationBuilder_Generic_Test.cpp libforqs libforqs_implementations ;
#unit-test Testing/TrajectoryTest : Testing/TrajectoryTest.cpp libforqs ;
#unit-test Testing/VariantIndicatorImplementationTest : Testing/VariantIndicatorImplementationTest.cpp VariantIndicatorImplementation.cpp libforqs ;
#unit-test muparser_test : muparser_test.cpp muparser//libmuparser ;


exe forqs : forqs.cpp libforqs libforqs_implementations ;
exe forqs_aux : forqs_aux.cpp libforqs ;
exe forqs_map_ms : forqs_map_ms.cpp libforqs ;
exe forqs_focal_subset : forqs_focal_subset.cpp libforqs libforqs_implementations ;


install bin  
    : forqs forqs_aux forqs_map_ms forqs_focal_subset
    : <location>../bin 
      <install-dependencies>on
      <install-type>EXE
      <install-type>LIB
      <link>static
      <runtime-link>static
    ;


#
# cross-compilation for Windows
# (works with Ubuntu mingw installation)
#
# define toolset gcc-windows in user-config.jam:
#   using gcc : windows : i686-w64-mingw32-g++ : <archiver>i686-w64-mingw32-ar <ranlib>i686-w64-mingw32-ranlib ;
#   format: using [tool] : [version] : [executable] : [options] ;
#


install windows
    : forqs forqs_aux forqs_map_ms
    : <location>../bin_windows
      <install-type>EXE
      <toolset>gcc-windows
      <runtime-link>static
      <link>static
      <target-os>windows
    ;

explicit windows ; # don't build by default


